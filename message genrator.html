<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTM Message Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to use the Inter font (or system fallback) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .message-box {
            white-space: pre-wrap; /* Preserve formatting and line breaks */
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-gray-100">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-2">PTM Invitation Message Tool</h1>
        <p class="text-gray-500 mb-8">Customize the date, time, and recipient to generate and send the message instantly.</p>

        <!-- Input Controls -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Date Picker -->
            <div>
                <label for="date-input" class="block text-sm font-medium text-gray-700 mb-1">Select Date</label>
                <input type="date" id="date-input" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out shadow-sm text-gray-800">
            </div>
            
            <!-- Time Picker -->
            <div>
                <label for="time-input" class="block text-sm font-medium text-gray-700 mb-1">Select Time</label>
                <input type="time" id="time-input" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out shadow-sm text-gray-800">
            </div>

             <!-- Phone Number Input -->
            <div>
                <label for="phone-input" class="block text-sm font-medium text-gray-700 mb-1">WhatsApp Number (e.g., 919876543210)</label>
                <input type="tel" id="phone-input" placeholder="Country code required (no + or spaces)"
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150 ease-in-out shadow-sm text-gray-800">
            </div>
        </div>

        <!-- Generated Message Output -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Generated Invitation Message</label>
            <div id="message-output" 
                 class="message-box bg-gray-50 p-4 border border-gray-200 rounded-lg text-gray-700 min-h-[120px]">
                Please select a date and time.
            </div>
        </div>

        <!-- Action Buttons (Copy and WhatsApp Send) -->
        <div class="flex flex-col sm:flex-row justify-end gap-4">
            <!-- Send via WhatsApp Button -->
            <button id="whatsapp-button" 
                    class="order-first sm:order-last px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-50"
                    disabled>
                <!-- Icon for WhatsApp/Message -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12.04 2C6.54 2 2.08 6.46 2.08 11.96c0 1.76.46 3.42 1.3 4.88L2 22l5.24-1.37c1.39.77 2.97 1.2 4.8 1.2 5.5 0 9.97-4.46 9.97-9.96S17.54 2 12.04 2zm3.33 13.93c-.09.23-.31.28-.56.12l-1.92-.93c-.22-.11-.49-.1-.73.04l-1.16 1.15c-.32.32-.82.17-1.15-.15-.71-.7-1.32-1.48-1.84-2.31-.56-.88-.93-1.87-1.07-2.92-.04-.26.1-.53.33-.66l1.92-1.07c.25-.14.39-.42.3-.67l-.23-.62c-.12-.32-.42-.51-.76-.51H8.09c-.31 0-.61.16-.79.43L6.37 9.87c-.63 1.05-.72 2.37.04 3.7.83 1.48 2.05 2.7 3.53 3.53 1.32.74 2.65.62 3.7.04l1.17-1.29c.17-.2.27-.45.27-.72 0-.32-.17-.6-.43-.76z"/>
                </svg>
                Send via WhatsApp
            </button>

            <!-- Copy Button -->
            <button id="copy-button" 
                    class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-50"
                    disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                    <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h4a2 2 0 00-2-2H5z" />
                </svg>
                Copy Message
            </button>
        </div>

        <!-- Status Message (for copying/sending) -->
        <div id="status-message" class="mt-4 text-center text-sm text-green-600 opacity-0 transition-opacity duration-300"></div>

    </div>

    <script>
        // DOM Elements
        const dateInput = document.getElementById('date-input');
        const timeInput = document.getElementById('time-input');
        const phoneInput = document.getElementById('phone-input'); // New
        const messageOutput = document.getElementById('message-output');
        const copyButton = document.getElementById('copy-button');
        const whatsappButton = document.getElementById('whatsapp-button'); // New
        const statusMessage = document.getElementById('status-message');

        // The base template for the message
        const TEMPLATE = `Hi I am Damini from Allen, I would like to invite you for PTM on upcomming {DATE} at {TIME}.
Thanks, Damini`;

        // Function to format the date string (YYYY-MM-DD) into a readable format
        function formatReadableDate(dateString) {
            if (!dateString) return null;
            try {
                const date = new Date(dateString + 'T00:00:00'); // Append T00:00:00 to avoid timezone issues
                return new Intl.DateTimeFormat('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }).format(date);
            } catch (e) {
                console.error("Date formatting error:", e);
                return dateString;
            }
        }

        // Function to format the time string (HH:MM) into 12-hour format
        function formatReadableTime(timeString) {
            if (!timeString) return null;
            try {
                const [hours, minutes] = timeString.split(':');
                const date = new Date();
                date.setHours(parseInt(hours, 10), parseInt(minutes, 10));

                return new Intl.DateTimeFormat('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit', 
                    hour12: true 
                }).format(date);
            } catch (e) {
                console.error("Time formatting error:", e);
                return timeString;
            }
        }

        // Function to generate and update the message
        function generateMessage() {
            const dateValue = dateInput.value;
            const timeValue = timeInput.value;
            const phoneValue = phoneInput.value.trim(); // Get phone value

            const formattedDate = formatReadableDate(dateValue);
            const formattedTime = formatReadableTime(timeValue);
            
            let isMessageReady = false;
            let finalMessage = "Please select a date and time to generate the final PTM message.";

            if (formattedDate && formattedTime) {
                // Replace placeholders in the template
                finalMessage = TEMPLATE
                    .replace('{DATE}', formattedDate)
                    .replace('{TIME}', formattedTime);
                
                isMessageReady = true;
            }

            messageOutput.textContent = finalMessage;

            // Enable/Disable Copy button
            copyButton.disabled = !isMessageReady;
            copyButton.classList.toggle('disabled:opacity-50', !isMessageReady);

            // Enable/Disable WhatsApp button - requires message ready AND a phone number (10+ digits recommended)
            const phoneReady = phoneValue.replace(/[^0-9]/g, '').length >= 10;
            const whatsappReady = isMessageReady && phoneReady;
            
            whatsappButton.disabled = !whatsappReady;
            whatsappButton.classList.toggle('disabled:opacity-50', !whatsappReady);
        }

        // Function to handle copying the message
        function copyMessage() {
            const textToCopy = messageOutput.textContent;
            
            // Use document.execCommand('copy') as navigator.clipboard might fail in some environments (like iframes)
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = textToCopy;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    statusMessage.textContent = 'Message copied to clipboard!';
                    statusMessage.classList.remove('opacity-0', 'text-red-600');
                    statusMessage.classList.add('text-green-600');
                    setTimeout(() => {
                        statusMessage.classList.add('opacity-0');
                    }, 2000);
                } else {
                    // Fallback in case copy fails
                    console.error('Copying failed.');
                    statusMessage.textContent = 'Copying failed. Please copy manually.';
                    statusMessage.classList.remove('opacity-0', 'text-green-600');
                    statusMessage.classList.add('text-red-600');
                    setTimeout(() => {
                        statusMessage.classList.add('opacity-0');
                        statusMessage.classList.remove('text-red-600');
                    }, 3000);
                }
            } catch (err) {
                console.error('Could not copy text: ', err);
                statusMessage.textContent = 'Copying failed. Please copy manually.';
                statusMessage.classList.remove('opacity-0', 'text-green-600');
                statusMessage.classList.add('text-red-600');
                setTimeout(() => {
                    statusMessage.classList.add('opacity-0');
                    statusMessage.classList.remove('text-red-600');
                }, 3000);
            }
            
            document.body.removeChild(tempTextarea);
        }
        
        // New function to send the WhatsApp message
        function sendWhatsAppMessage() {
            // Strip non-numeric characters and ensure country code is included (e.g., 91...)
            const phoneNumber = phoneInput.value.replace(/[^0-9]/g, ''); 
            const message = messageOutput.textContent;
            
            if (!phoneNumber || !message) {
                statusMessage.textContent = 'Error: Please ensure the date/time are set and a phone number is entered.';
                statusMessage.classList.remove('opacity-0', 'text-green-600');
                statusMessage.classList.add('text-red-600');
                setTimeout(() => {
                    statusMessage.classList.add('opacity-0');
                    statusMessage.classList.remove('text-red-600');
                }, 3000);
                return;
            }

            // URL encode the message content
            const encodedMessage = encodeURIComponent(message);
            // Construct the WhatsApp URL
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;

            // Open the URL in a new tab/window
            window.open(whatsappUrl, '_blank');
            
            // Provide feedback
            statusMessage.textContent = 'Opening WhatsApp link...';
            statusMessage.classList.remove('opacity-0', 'text-red-600');
            statusMessage.classList.add('text-green-600');
            setTimeout(() => {
                statusMessage.classList.add('opacity-0');
            }, 2000);
        }

        // Event Listeners
        dateInput.addEventListener('change', generateMessage);
        timeInput.addEventListener('change', generateMessage);
        phoneInput.addEventListener('input', generateMessage); // New listener for phone number
        copyButton.addEventListener('click', copyMessage);
        whatsappButton.addEventListener('click', sendWhatsAppMessage); // New listener for WhatsApp button

        // Initial call to set the placeholder message on load
        window.onload = generateMessage;

    </script>
</body>
</html>