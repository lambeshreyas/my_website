<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTM Message Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to use the Inter font (or system fallback) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .message-box {
            white-space: pre-wrap; /* Preserve formatting and line breaks */
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-gray-100">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-2">PTM Invitation Message Tool</h1>
        <p class="text-gray-500 mb-8">Customize the details to generate, copy, and send the message instantly.</p>

        <!-- Input Controls Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            
            <!-- Student Name -->
            <div class="md:col-span-2">
                <label for="student-name-input" class="block text-sm font-medium text-gray-700 mb-1">Student Name</label>
                <input type="text" id="student-name-input" placeholder="Aarohi" value="Aarohi"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out shadow-sm text-gray-800">
            </div>

            <!-- Date Picker -->
            <div>
                <label for="date-input" class="block text-sm font-medium text-gray-700 mb-1">Select Date</label>
                <input type="date" id="date-input" 
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out shadow-sm text-gray-800">
            </div>
            
            <!-- Time Picker -->
            <div>
                <label for="time-input" class="block text-sm font-medium text-gray-700 mb-1">Select Time</label>
                <input type="time" id="time-input" 
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out shadow-sm text-gray-800">
            </div>
            
            <!-- Primary WhatsApp Number Input -->
            <div>
                <label for="phone-input" class="block text-sm font-medium text-gray-700 mb-1">Primary WhatsApp Number (e.g., 919876543210)</label>
                <input type="tel" id="phone-input" placeholder="Country code required (no + or spaces)"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150 ease-in-out shadow-sm text-gray-800">
            </div>

            <!-- Extra WhatsApp Number Input -->
            <div>
                <label for="extra-phone-input" class="block text-sm font-medium text-gray-700 mb-1">Extra WhatsApp Number (Optional)</label>
                <input type="tel" id="extra-phone-input" placeholder="Optional secondary number"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150 ease-in-out shadow-sm text-gray-800">
            </div>
        </div>

        <!-- Generated Message Output -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Generated Invitation Message</label>
            <div id="message-output" 
                 class="message-box bg-gray-50 p-4 border border-gray-200 rounded-lg text-gray-700 min-h-[120px]">
                Please enter the student's name, select a date, and time.
            </div>
        </div>

        <!-- Action Buttons (Copy and WhatsApp Send) -->
        <div class="flex flex-col sm:flex-row justify-end gap-4">
            
            <!-- Copy Button -->
            <button id="copy-button" 
                    class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-50"
                    disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                    <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h4a2 2 0 00-2-2H5z" />
                </svg>
                Copy Message
            </button>

            <!-- Single Smart Send WhatsApp Button -->
            <button id="whatsapp-button-send" 
                    class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-50"
                    disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12.04 2C6.54 2 2.08 6.46 2.08 11.96c0 1.76.46 3.42 1.3 4.88L2 22l5.24-1.37c1.39.77 2.97 1.2 4.8 1.2 5.5 0 9.97-4.46 9.97-9.96S17.54 2 12.04 2zm3.33 13.93c-.09.23-.31.28-.56.12l-1.92-.93c-.22-.11-.49-.1-.73.04l-1.16 1.15c-.32.32-.82.17-1.15-.15-.71-.7-1.32-1.48-1.84-2.31-.56-.88-.93-1.87-1.07-2.92-.04-.26.1-.53.33-.66l1.92-1.07c.25-.14.39-.42.3-.67l-.23-.62c-.12-.32-.42-.51-.76-.51H8.09c-.31 0-.61.16-.79.43L6.37 9.87c-.63 1.05-.72 2.37.04 3.7.83 1.48 2.05 2.7 3.53 3.53 1.32.74 2.65.62 3.7.04l1.17-1.29c.17-.2.27-.45.27-.72 0-.32-.17-.6-.43-.76z"/>
                </svg>
                Send WhatsApp Message
            </button>
        </div>

        <!-- Status Message (for copying/sending) -->
        <div id="status-message" class="mt-4 text-center text-sm text-green-600 opacity-0 transition-opacity duration-300"></div>

    </div>

    <script>
        // DOM Elements
        const studentNameInput = document.getElementById('student-name-input'); 
        const dateInput = document.getElementById('date-input');
        const timeInput = document.getElementById('time-input');
        const phoneInput = document.getElementById('phone-input');
        const extraPhoneInput = document.getElementById('extra-phone-input'); 
        const messageOutput = document.getElementById('message-output');
        const copyButton = document.getElementById('copy-button');
        const whatsappButtonSend = document.getElementById('whatsapp-button-send'); // Consolidated button
        const statusMessage = document.getElementById('status-message');

        // The base template for the message 
        const TEMPLATE = `Dear parent of *{STUDENT_NAME}*

*Allen Career Institute Latur - PNCF* Division is happy to welcome you to a *Mentors meet* session this Sunday.

Date: {DATE}
Time: {TIME}

*Agenda:* How to overcome the anxiety and maintain discipline in last 3 months to achieve best result.

Hoping to see you at _Allen Laxmi Landmark_ campus this Sunday!

Regards,
DAMINI PIMPALSHENDE
PNCF - BIOLOGY Faculty
*Allen Career Institute, Latur*`;

        // Function to format the date string (YYYY-MM-DD) into a readable format
        function formatReadableDate(dateString) {
            if (!dateString) return null;
            try {
                const date = new Date(dateString + 'T00:00:00'); 
                return new Intl.DateTimeFormat('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }).format(date);
            } catch (e) {
                console.error("Date formatting error:", e);
                return dateString;
            }
        }

        // Function to format the time string (HH:MM) into 12-hour format
        function formatReadableTime(timeString) {
            if (!timeString) return null;
            try {
                const [hours, minutes] = timeString.split(':');
                const date = new Date();
                date.setHours(parseInt(hours, 10), parseInt(minutes, 10));

                return new Intl.DateTimeFormat('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit', 
                    hour12: true 
                }).format(date);
            } catch (e) {
                console.error("Time formatting error:", e);
                return timeString;
            }
        }

        // Function to generate and update the message
        function generateMessage() {
            const nameValue = studentNameInput.value.trim() || 'Aarohi';
            const dateValue = dateInput.value;
            const timeValue = timeInput.value;
            const phoneValue = phoneInput.value.trim();
            const extraPhoneValue = extraPhoneInput.value.trim();
            
            const formattedDate = formatReadableDate(dateValue);
            const formattedTime = formatReadableTime(timeValue);
            
            let isMessageReady = false;
            let finalMessage = "Please enter the student's name, select a date, and time.";

            if (nameValue && formattedDate && formattedTime) {
                // Replace placeholders in the template
                finalMessage = TEMPLATE
                    .replace('{STUDENT_NAME}', nameValue)
                    .replace('{DATE}', formattedDate)
                    .replace('{TIME}', formattedTime);
                
                isMessageReady = true;
            }

            messageOutput.textContent = finalMessage;

            // Check if essential fields are ready
            const isEssentialReady = isMessageReady;
            
            // Utility function to check if phone number is ready (clean and has 10+ digits)
            const isPhoneReady = (phone) => phone.replace(/[^0-9]/g, '').length >= 10;
            
            const phonePrimaryReady = isPhoneReady(phoneValue);
            const phoneExtraReady = isPhoneReady(extraPhoneValue);
            
            // The single Send button is ready if message is ready AND (Primary OR Extra number is ready)
            const whatsappSendReady = isEssentialReady && (phonePrimaryReady || phoneExtraReady); 


            // Enable/Disable buttons based on readiness
            copyButton.disabled = !isEssentialReady;
            copyButton.classList.toggle('disabled:opacity-50', !isEssentialReady);
            
            // Update the single Send button state
            whatsappButtonSend.disabled = !whatsappSendReady;
            whatsappButtonSend.classList.toggle('disabled:opacity-50', !whatsappSendReady);
        }

        // Function to handle copying the message
        function copyMessage() {
            const textToCopy = messageOutput.textContent;
            
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = textToCopy;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            
            try {
                const successful = document.execCommand('copy');
                const successMsg = 'Message copied to clipboard!';
                const failMsg = 'Copying failed. Please copy manually.';

                statusMessage.textContent = successful ? successMsg : failMsg;
                statusMessage.classList.remove('opacity-0', successful ? 'text-red-600' : 'text-green-600');
                statusMessage.classList.add(successful ? 'text-green-600' : 'text-red-600');
                setTimeout(() => {
                    statusMessage.classList.add('opacity-0');
                    statusMessage.classList.remove('text-red-600', 'text-green-600');
                }, successful ? 2000 : 3000);

            } catch (err) {
                console.error('Could not copy text: ', err);
                statusMessage.textContent = 'Copying failed. Please copy manually.';
                statusMessage.classList.remove('opacity-0', 'text-green-600');
                statusMessage.classList.add('text-red-600');
                setTimeout(() => {
                    statusMessage.classList.add('opacity-0');
                    statusMessage.classList.remove('text-red-600');
                }, 3000);
            }
            
            document.body.removeChild(tempTextarea);
        }
        
        // Helper function to open the WhatsApp window
        function openWhatsAppWindow(phoneNumber, message) {
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // Function to handle sending WhatsApp message to one or both numbers
        function handleWhatsAppSend() {
            const message = messageOutput.textContent;
            
            const phonePrimary = phoneInput.value.replace(/[^0-9]/g, '');
            const phoneExtra = extraPhoneInput.value.replace(/[^0-9]/g, '');

            const phonePrimaryReady = phonePrimary.length >= 10;
            const phoneExtraReady = phoneExtra.length >= 10;
            
            let statusText = '';
            
            if (!message) return; // Should not happen if button is enabled

            if (phonePrimaryReady && phoneExtraReady) {
                // Case 1: Send to BOTH
                openWhatsAppWindow(phonePrimary, message);
                // Use a slight delay to ensure browser handles multiple pop-ups smoothly
                setTimeout(() => { openWhatsAppWindow(phoneExtra, message); }, 50); 
                statusText = 'Opened WhatsApp links for Primary and Extra numbers (two windows/tabs).';
                
            } else if (phonePrimaryReady) {
                // Case 2: Send only to PRIMARY
                openWhatsAppWindow(phonePrimary, message);
                statusText = 'Opened WhatsApp link for Primary number.';
                
            } else if (phoneExtraReady) {
                // Case 3: Send only to EXTRA
                openWhatsAppWindow(phoneExtra, message);
                statusText = 'Opened WhatsApp link for Extra number.';

            } else {
                 // This case should not be reached if button logic is correct.
                 statusText = 'Error: No valid WhatsApp number entered.';
                 statusMessage.classList.remove('text-green-600');
                 statusMessage.classList.add('text-red-600');
            }
            
            // Status update
            statusMessage.textContent = statusText;
            statusMessage.classList.remove('opacity-0', 'text-red-600');
            statusMessage.classList.add('text-green-600');
            setTimeout(() => {
                statusMessage.classList.add('opacity-0');
            }, 4000);
        }

        // Event Listeners
        studentNameInput.addEventListener('input', generateMessage);
        dateInput.addEventListener('change', generateMessage);
        timeInput.addEventListener('change', generateMessage);
        phoneInput.addEventListener('input', generateMessage);
        extraPhoneInput.addEventListener('input', generateMessage); 
        
        copyButton.addEventListener('click', copyMessage);
        
        // Single Send WhatsApp Button handler
        whatsappButtonSend.addEventListener('click', handleWhatsAppSend);

        // Initial call to set the placeholder message on load
        window.onload = generateMessage;

    </script>
</body>
</html>
